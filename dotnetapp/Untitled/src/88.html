<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\users\rogera\source\repos\dotnetstd\dnslib\factoryfloor\mqcomponent\usecase\queuemessagesusecase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Text;
using System.Threading;
using RabbitMQ.Client;

namespace DnsLib.FactoryFloor.MqComponent.UseCase
{
    #region using directives

    #endregion

    /// &lt;summary&gt;The queue messages use case.&lt;/summary&gt;
    public static class QueueMessagesUseCase
    {
        /// &lt;summary&gt;The interval add luftschnappen amount.&lt;/summary&gt;
        private const int IntervalAddLuftschnappenAmount = 450;

        /// &lt;summary&gt;The interval add luftschnappen every nth tick.&lt;/summary&gt;
        private const int IntervalAddLuftschnappenEveryNthTick = 120;

        /// &lt;summary&gt;The interval reduce.&lt;/summary&gt;
        private const int IntervalReduce = 50;

        /// &lt;summary&gt;The interval start.&lt;/summary&gt;
        private const int IntervalStart = 650;

        /// &lt;summary&gt;The interval stays above limit.&lt;/summary&gt;
        private const int IntervalStaysAboveLimit = 50;

        /// &lt;summary&gt;The interval substeps.&lt;/summary&gt;
        private const int IntervalSubsteps = 6;

        /// &lt;summary&gt;The interval.&lt;/summary&gt;
        private static int _interval = IntervalStart;

        /// &lt;summary&gt;The interval substep current.&lt;/summary&gt;
        private static int _intervalSubstepCurrent = IntervalSubsteps;

        /// &lt;summary&gt;The test message.&lt;/summary&gt;
        private static readonly string TestMessage = typeof(QueueMessagesUseCase) + &quot;:TEST_MESSAGE:&quot;;


        /// &lt;summary&gt;The execute.&lt;/summary&gt;
        /// &lt;param name=&quot;pMessageCount&quot;&gt;The p message count.&lt;/param&gt;
        /// &lt;param name=&quot;mqOperationsEngine&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;withThreadSleepFlag&quot;&gt;&lt;/param&gt;
        public static void Execute(int pMessageCount, MqOperationsEngine mqOperationsEngine, bool withThreadSleepFlag)
        {
            using (var connection = mqOperationsEngine.CreateConnection())
            {
                using (var channel = connection.CreateModel())
                {
                    channel.QueueDeclare(mqOperationsEngine.QueueName, true, false, false, null);

                    var l = new List&lt;int&gt;();
                    _intervalSubstepCurrent = IntervalSubsteps;
                    for (var i = 0; i &lt; pMessageCount; i++) l.Add(i);
                    l.ForEach(
                        i =&gt;
                        {
                            var message =
                                $&quot;#### {i,4} ||| {TestMessage} Hello World!\n\t:#{i,4} @ intvl: {_interval}/{_intervalSubstepCurrent}&quot;;
                            var body = Encoding.UTF8.GetBytes(message);
                            channel.BasicPublish(string.Empty, &quot;hello&quot;, null, body);
                            if (withThreadSleepFlag) Thread.Sleep(TimeSpan.FromMilliseconds(_interval));

                            if (_intervalSubstepCurrent-- == 0)
                            {
                                _intervalSubstepCurrent = IntervalSubsteps;
                                if (_interval &gt; IntervalStaysAboveLimit) _interval -= IntervalReduce;
                            }

                            // bissl luftschnappen hin und wieder
                            if (i % IntervalAddLuftschnappenEveryNthTick == 0)
                                _interval += IntervalAddLuftschnappenAmount;
                        });
                }
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[35,9,35,54,1],[38,9,38,71,1],[41,9,41,102,1],[49,9,49,10,1],[50,20,50,74,1],[51,13,51,14,1],[52,24,52,62,1],[53,17,53,18,1],[54,21,54,98,1],[56,21,56,45,1],[57,21,57,64,1],[58,26,58,35,1],[58,37,58,54,1],[58,56,58,59,1],[58,61,58,70,1],[59,21,61,25,1],[61,25,61,26,1],[61,26,62,29,1],[62,29,63,136,1],[63,136,64,29,1],[64,29,64,72,1],[64,72,65,29,1],[65,29,65,85,1],[65,85,66,29,1],[66,29,66,53,1],[66,53,66,54,1],[66,54,66,105,0],[66,105,68,29,1],[68,29,68,64,1],[68,64,69,29,1],[69,29,69,30,1],[69,30,70,33,1],[70,33,70,76,1],[70,76,71,33,1],[71,33,71,73,1],[71,73,71,74,1],[71,74,71,102,1],[71,102,72,29,1],[72,29,72,30,1],[72,30,75,29,1],[75,29,75,79,1],[75,79,76,33,1],[76,33,76,77,1],[76,77,77,25,1],[77,25,77,26,1],[77,26,77,28,1],[59,21,77,28,1],[78,17,78,18,1],[79,13,79,14,1],[80,9,80,10,1]]);
    </script>
  </body>
</html>